<h3>Plugin overview</h3>

<p>This plugin allows you to add forms to your skins or items that will be mailed to a given address 
or addresses when submitted by site visitors. Spam fighting measures can be implemented on each form. 
File uploads are permitted.</p>

<p>
It is based on a plugin I wrote to have employment applications submitted on-line that would be mailed 
to a backend system for processing.
</p>

<p>
This plugin includes the htmlMimeMail package 
(<a href="http://www.phpguru.org/" class="urlextern" target="_blank" title="http://www.phpguru.org/"  rel="nofollow">http://www.phpguru.org/</a>), 
© Copyright 2004 Richard Heyes, distributed under the GNU General Public License version 2. 
</p>

<ul>
<li><a href="#installing">Installation</a></li>
<li><a href="#options">Plugin Options</a></li>
<li><a href="#how_to_use_the_plugin">How to use the plugin</a></li>
<li><a href="#skinvars">SkinVars</a></li>
<li><a href="#advanced">Advanced Usage</a>
	<ul>
		<li><a href="#advanced-templates">Custom Output Templates</a></li>
		<li><a href="#advanced-DPC-CSS">Custom Date Picker Styles</a></li>
	</ul>
</li>
<li><a href="#history">History</a></li>
</ul>

<h3><a name="installation">Installation</a></h3>

<p>The NP_MailForm plugin can be downloaded from 
<a href="http://revcetera.com/ftruscot/downloads/nucleus_plugins.html#mailform" title="Download NP_MailForm">here</a>.
</p>

<p>Download and extract the zip file. Copy the NP_MailForm.php file and the profile directory to the nucleus/plugins directory.</p>

<p>Use the Nucleus Admin GUI to register the NP_MailForm plugin into Nucleus. Be sure to click the &lsquo;Update subscription list&rsquo; button.</p>

<p>You will need to edit and save the plugin options before using the plugin. The options are described below.</p>

<h3><a name="options">Plugin Options</a></h3>
<p>There are a number of options that control the operation of the Profile plugin. These options are set from the &lsquo;edit options&rsquo; link in the Plugin Admin area. The options are described below.</p>

<h4>Plugin Options</h4>
<ul>
<li><code>Show Admin Area in quick menu</code> : Whether the MailForm admin area should be shown in the Quick Menu area. yes or no. (yes)</li>
<li><code>Delete MailForm user data table on uninstall?</code> : Whether the database table containing your user data should be deleted on an uninstall. This should be set to &lsquo;yes&rsquo; only when permanently removing NP_MailForm. yes or no. (no)</li>
</ul>

<h3><a name="how_to_use_the_plugin">How to use the plugin</a></h3>

<p>
In order to use this plugin, you need to create an html form that includes the fields you desire and the 
submit button. You do not need the initial form tag. You will then add a few MailForm tags to add the 
MailForm features to your form. You can store the form in one of three ways as described later.
</p>

<p>
A sample form is shown below: 
</p>
<p>
<b>Note: This example uses some simple HTML fields generated by MailForm, 
as well as one HTML field entered directly as HTML. By using HTML, you can 
create any valid HTML field. The ones generated by the plugin are limited. 
Descriptions of the variables used in this example will be given later.</b>
</p>
<pre><code>&lt;%MailForm(status)%&gt;&lt;br /&gt;
&lt;%MailForm(js-validate)%&gt;
&lt;%MailForm(js-date,french)%&gt;
&lt;%MailForm(startform,mycontact,yes)%&gt;
&lt;%MailForm(sticket,mycontact)%&gt;
&lt;%MailForm(field,subject_template,hidden,)%&gt;
&lt;%MailForm(field,body_template,hidden,)%&gt;
&lt;p align="left"&gt;
&lt;b&gt;Name (Required)&lt;/b&gt;&lt;br /&gt;
&lt;input name="FullName" size="30" /&gt;
&lt;/p&gt;
&lt;p align="left"&gt;
&lt;b&gt;Email Address (Required)&lt;/b&gt;&lt;br /&gt;
&lt;%MailForm(field,EmailAddress,text,30)%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;Topic&lt;/b&gt;&lt;br /&gt;
&lt;%MailForm(field,Topic,dropdown,General;Sales;Support;Employment,General)%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;Question (Required)&lt;/b&gt;&lt;br /&gt;
&lt;%MailForm(field,Question,textarea,10:30)%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;Is this important?&lt;/b&gt;&lt;br /&gt;
&lt;%MailForm(field,Important,radio,yes:IMPORTANT;no:Low Priority;maybe:Normal,Low Priority)%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;DueDate&lt;/b&gt;&lt;br /&gt;
&lt;%MailForm(field,DueDate,date,YYYY-MM-DD)%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;Attachment&lt;/b&gt;&lt;br /&gt;
&lt;%MailForm(field,SupportFile,file)%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;%MailForm(captcha,mycontact)%&gt;&lt;/p&gt;
&lt;p&gt;
&lt;font size="2"&gt;
&lt;%MailForm(button,submit,Submit)%&gt;
&lt;%MailForm(button,reset,Reset)%&gt;
&lt;/font&gt;&lt;/p&gt;

&lt;/form&gt;</code></pre>

<h3><a name="skinvars"></a>SkinVars</h3>

<p>These skinvars are available in your skins and items, 
as well as in mailform template files and the Form Body field 
of the Form Definition page, as described later.
</p>

<ul>
	<li><b> &lt;%MailForm(status,<em>formname</em>)%&gt;</b> - Displays the status message defined in the form 
		definition (or a default message) when a form is successfully submitted.</li>
	<li><b> &lt;%MailForm(js-validate)%&gt;</b> - Inserts the javascript code used to validate required fields 
		before final submission. This tag should be before the 
		&lt;%MailForm(startform,<em>formname</em>,<em>useJSValidate</em>)%&gt; tag and <em>useJSValidate</em> should 
		be 'yes'.</li>
	<li><b> &lt;%MailForm(js-date,<em>language</em>,<em>alternate_css</em>)%&gt;</b> - Inserts the javascript code used to provide a date picker control 
		for date fields. The date field must be created using a 
		&lt;%MailForm(field,<em>fieldname</em>,date,<em>dateformat</em>)%&gt; variable. <em>language</em> determines the 
		language used in the date picker. Default is english. Available options are: french, spanish, german, german-alt, 
		dutch, italian, polish, romanian, norwegian, hungarian, portuguese, portuguese-pt, portuguese-br, swedish, euskera, 
		czech, turkish. <em>alternate_css</em> specifies an alternate css file used to style the date picker. Choices are 
		darkred, bluegray, lnx, and mozilla. You can make your own style sheet for the picker. See 
		<a href="#advanced-DPC-CSS">Advanced Usage</a> section for details.</li>
	<li><b> &lt;%MailForm(startform,<em>formname</em>,<em>useJSValidate</em>)%&gt;</b> - Inserts the html code 
		(the &lt;form&gt; tag) to start a form that will be processed by NP_MailForm. <em>formname</em> should be the 
		name of an existing form defined in the plugins admin page. <em>useJSValidate</em> should be 'yes' or 'no' and 
		indicated whether you will be using javascript to validate the required fields and requires use of 
		&lt;%MailForm(js-validate)%&gt; somewhere outside your form.</li>	
	<li><b> &lt;%MailForm(sticket,<em>formname</em>)%&gt;</b> - Inserts a key into the form that is uniwue to 
		the visitor&rsquo;s IP address. This is a spam-fighting feature. The key is checked by the form processor 
		and if that IP address hasn&rsquo;t loaded the form within the past 30 minutes, the submission will be denied.</li>
	<li><b> &lt;%MailForm(captcha,<em>formname</em>)%&gt;</b> - Inserts the code required for a captcha test 
		(characters embedded in an image) for guest visitors. Requires NP_Captcha.</li>

	<li><b> &lt;%MailForm(field,<em>fieldname</em>,<em>field_type</em>,<em>param4</em>,<em>param5</em>)%&gt;</b> - 
		Inserts the HTML code to add input fields to a form. <em>fieldname</em> must be unique for the form. 
		<em>param4</em> and <em>param5</em> have different purposes for the different <em>field_type</em> as 
		described below:
		<ul>
			<li><b>text</b> - generates a simple text input. <em>param4</em> is the size of the field, default is 
				30. <em>param5</em> is the initial value of the field, default is ''</li>
			<li><b>textarea</b> - generates a simple textarea (multi-line) input. <em>param4</em> is the size of 
				the field in the format of rows:cols, default is 10:50. <em>param5</em> is the initial value of 
				the field, default is ''</li>
			<li><b>file</b> - generates a file upload input. <em>param4</em> and <em>param5</em> are ignored</li>
			<li><b>hidden</b> - generates a hidden field. <em>param4</em> is the value of the field, default is 
				''. <em>param5</em> is ignored</li>
			<li><b>radio</b> - generates a radio input. <em>param4</em> is the options of the field in the form 
				choice1;choice2;choice3;etc... where a choice can be a single value or a display:value pair, such 
				as display1:value1;display2:value2;display3:value3;etc... display is what the user sees on the 
				form and the value is what gets submitted. <em>param5</em> is the initial value of the field, 
				default is ''</li>
			<li><b>yesno</b> - is a special case of the radio type where the choices are 'yes' or 'no'. 
				<em>param4</em> is the initial value of the field, default is ''</li>
			<li><b>dropdown</b> - generates a dropdown input. <em>param4</em> is the options of the field in the form 
				choice1;choice2;choice3;etc... where a choice can be a single value or a display:value pair, such 
				as display1:value1;display2:value2;display3:value3;etc... display is what the user sees on the 
				form and the value is what gets submitted. <em>param5</em> is the initial value of the field, 
				default is ''</li>
			<li><b>checkbox</b> - generates a checkbox input. <em>param4</em> is the options of the field in the form 
				choice1;choice2;choice3;etc... where a choice can be a single value or a display:value pair, such 
				as display1:value1;display2:value2;display3:value3;etc... display is what the user sees on the 
				form and the value is what gets submitted. <em>param5</em> is the initial value of the field in 
				the form of value1;value2;value3;etc..., default is ''</li>
			<li><b>date</b> - generates a date input, which when combined with <b>js-date</b> will give a javascript 
				date picker control. <em>param4</em> is the date format of the field, default is MM-DD-YYYY. Possible 
				values are 'DD/MM/YYYY', 'DD-MM-YYYY', 'MM-DD-YYYY', 'MM/DD/YYYY', 'YYYY-MM-DD', 'YYYY/MM/DD', 
				'DD.MM.YYYY', 'DD.MM.YY' (without the quotes). <em>param5</em> is ignored.</li>			
		</ul>
	</li>
	
	<li><b> &lt;%MailForm(button,<em>button_type</em>,<em>button_label</em>,<em>button_name</em>)%&gt;</b> - 
		Inserts the HTML code to add input fields to a form. <em>button_type</em> must be unique for the form and 
		is either submit or reset. <em>button_label</em> is the text displayed on the button. <em>button_name</em> 
		is the internal name of the button and will be submitted as data with the form. It can be useful for 
		knowing which button was clicked during submit. It is optional and is considered an advanced option.
	</li>
	
	<li><b> &lt;%MailForm(form,<em>formname</em>)%&gt;</b> - Inserts the contents of the Form Body field from 
the form definition. The Form Body field should contain all the html and MailForm tags to create the entire form. 
This allows you to store the form in the db and call it anywhere in your skins or items by using a single tag.</li>
	<li><b> &lt;%MailForm(template,<em>formname</em>,<em>loginAware</em>)%&gt;</b> - Inserts the form by parsing a 
file called the same as <em>formname</em>.template in the nucleus/plugins/mailform/forms/ directory. If the 
<em>loginAware</em> parameter is &lsquo;yes&rsquo;, this tag will look for a file called 
<em>formname</em>.loggedin.template if the user is logged in or <em>formname</em>.notloggedin.template 
if the user is not logged in. This is much like the way the Nucleus 
<acronym title="Content Management System">CMS</acronym> core handles comment, login, search, and membermail 
forms. The advantage of this is that you can show different forms (or no form) to logged in visitors and 
to guests. You can also make use of some special tags in the template that inputs certain variables that 
you may need in the form. The form of these tags is &lt;%formdata(<em>parameter</em>)%&gt; and an example 
is given for the mycontact form in the distribution files. The available parameters are listed below 
(some are only useful for logged in users):
		<ul>
			<li><b>memberid</b> - if on member detail page, this is the id of the user whose page is being viewed</li>
			<li><b>realname</b> - if on member detail page, this is the real name of the user whose page is being viewed</li>
			<li><b>displayname</b> - if on member detail page, this is the display name of the user whose page is being viewed</li>
			<li><b>email</b> - if on member detail page, this is the email of the user whose page is being viewed</li>
			<li><b>url</b> - if on member detail page, this is the url of the user whose page is being viewed</li>
			<li><b>language</b> - if on member detail page, this is the language of the user whose page is being viewed</li>
			<li><b>mnumber</b> - id of the logged in member</li>
			<li><b>mrealname</b> - real name of the logged in member</li>

			<li><b>mdisplayname</b> - display name of the logged in member</li>
			<li><b>memail</b> - email address of the logged in member</li>
			<li><b>murl</b> - <acronym title="Uniform Resource Locator">URL</acronym> of the logged in member</li>
			<li><b>mlanguage</b> - preferred language of the logged in user</li>
			<li><b><em>fieldname</em></b> - all values of fields from a posted form can be recalled by name. </li>
		</ul>
	</li>
</ul>

<h3><a name="advanced"></a>Advanced Usage</h3>

<h4><a name="advanced-templates"></a>Custom Output Templates</h4>
<p>
Users of Nucleus CMS v 3.4 and higher can customize the formatting of the email subject and body using special 
template fields (MailForm_Subject and MailForm_Body) of any nucleus template. It's recommended that you create 
new templates that are only used for this purpose. For example, to customize the format of the subject and body 
of the email generated by a form called mycontact, you might create a nucleus template called mycontact and put 
your formatting in the MailForm Subject and MailForm Body fields of that template. To make MailForm use that 
template, you would insert the following tags within the mycontact form:
<pre><code>&lt;%MailForm(field,subject_template,hidden,mycontact)%&gt;
&lt;%MailForm(field,body_template,hidden,mycontact)%&gt;</code></pre> 
Mail form will see these hidden fields and during submit and format the email accordingly.
</p>

<p>The following fields are available in both the MailForm Subject and theMailForm Body fields, unless 
otherwise indicated:</p>
<ul>
	<li><b>&lt;%fieldprefix%&gt;</b> - The value of the Field Prefix field in the form definition.</li>
	<li><b>&lt;%bodystarttag%&gt;</b> - The value of the Body Start Tag field in the form definition.</li>
	<li><b>&lt;%bodyendtag%&gt;</b> - The value of the Body End Tag field in the form definition.</li>
	<li><b>&lt;%remote_ip%&gt;</b> - The IP address of the client submitting the form.</li>
	<li><b>&lt;%user_agent%&gt;</b> - The user agent of the client submitting the form.</li>
	<li><b>&lt;%referer%&gt;</b> - The HTTP referer, or URL of the page submitting the form.</li>
	<li><b>&lt;%formname%&gt;</b> - The name of the form being submitted.</li>
	<li><b>&lt;%header%&gt;</b> - A block of text including the remote_ip, user_agent, referer, and formname. 
		Not available in MailForm Subject field.</li>
	<li><b>&lt;%<em>fieldname</em>%&gt;</b> - The submitted value of the form field named <em>fieldname</em></li>
	<li><b>&lt;%fields%&gt;</b> - A running list of all submitted form fields. Each field is represented by a line 
		of the form: <em>fieldname</em>: <em>fieldvalue</em>. Not available in MailForm Subject field.</li>
	<li><b>&lt;%bodytext%&gt;</b> - The default formatted body text that would be used if no template was specified. 
		Not available in MailForm Subject field.</li>
	<!-- <li><b>&lt;%%&gt;</b> - </li>
	<li><b>&lt;%%&gt;</b> - </li>
	<li><b>&lt;%%&gt;</b> - </li> -->
</ul>

<p>
A sample MailForm Subject may look like this:
<pre><code>&lt;%Important%>: Website inquiry on &lt;%Topic%> from &lt;%FullName%></code></pre>
</p>

<p>
A sample MailForm Subject may look like this:
<pre><code>&lt;%bodystarttag%&gt;
&lt;%FullName%&gt; at &lt;%EmailAddress%&gt; wrote: 

&lt;%Question%&gt;

Concerning: &lt;%Topic%&gt; 
Priority: &lt;%Important%&gt;
Due Date: &lt;%DueDate%&gt;
&lt;%bodyendtag%&gt;
&lt;%header%&gt;</code></pre>
</p>

<h4><a name="advanced-DPC-CSS"></a>Custom Date Picker Control Style Sheet</h4>
<p>
To create a custom stylesheet, called mystyle in our example, for the date picker, you should first make a copy 
of the default css file, datepickercontrol.css (in the nucleus/plugins/mailform/datepickercontrol/ folder), 
and name the copy datepickercontrol_mystyle.css (in the same folder). Then modify the 
datepickercontrol_mystyle.css to suit your needs.
</p>

<p>
To make the picker use your style, modify the &lt;%MailForm(js-date,english)%&gt; variable above your form to 
look like &lt;%MailForm(js-date,english,mystyle)%&gt;. And voila!
</p>

<h3>Support and Bug reports</h3>

<p>For additional support and/or bug reports please use this forum thread:
<a href="http://forum.nucleuscms.org/viewtopic.php?t=16811">
http://forum.nucleuscms.org/viewtopic.php?t=16811</a></p>

<h3><a name="history"></a>Version History</h3>

<ul>
	<li> Version 1.10, release 18 April 2009
		<ul>
			<li> Use of templates for form output (email body)</li>
			<li> Add field and button skinvars to generate simple form fields and buttons</li>
			<li> Add javascript options for required field validation and date picker control</li>
		</ul>
	</li>
	<li> Version 1.00, private release</li>
	<li> Version 0.92, release 10 July 2008
		<ul>
			<li> xhtml compliance fix</li>
			<li> workaround for deprecated mime_content_type function</li>
		</ul>
	</li>
	<li> Version 0.91, release 24 January 2008
		<ul>
			<li> bug fixes</li>
		</ul>
	</li>
	<li> Version 0.9, released 15 January 2008
		<ul>
			<li> Initial Public Release</li>
		</ul>
	</li>
</ul>